NOTES ON DOCKER (Dockerfile.application + Dockerfile.database)

docker ps -a
docker images
docker stop $(docker ps -a -q) 2>/dev/null
docker rm $(docker ps -a -q) 2>/dev/null
docker rmi $(docker images -q) 2>/dev/null
docker ps -a
docker images


REMEMBER TO MIGRATE AND SEED THE DATABASE
docker build -t imomento-db -f Dockerfile.database .
docker run --name momento-db -e POSTGRES_PASSWORD=postgres -e POSTGRES_USER=postgres -e POSTGRES_DB=thesis -d imomento-db


docker build -t imomento-app -f Dockerfile.application .
docker run --name momento-app -p 3000:3000 -d imomento-app


---
BETTER UNDERSTANDING OF LINKING (deprecated): https://forums.docker.com/t/how-to-connect-application-to-postgres-in-docker-environment/4319/4

DATABASE: docker run --rm -p 5432:5432 --name momento-db -e POSTGRES_PASSWORD=postgres -e POSTGRES_USER=postgres -e POSTGRES_DB=thesis -d imemento-db

DATABASE CLIENT: psql -h localhost -p 5432 -d imemento-db -U postgres --password

LINK APPLICATION: docker run --rm -p 3000:3000 --name momento-app --link momento-db:postgres -d imomento-app


LOGIN TO CONTAINER: docker exec -it momento-app sh
TYPE: env | grep POSTGR
POSTGRES_ENV_PG_VERSION=9.6.3
POSTGRES_ENV_LANG=en_US.utf8
POSTGRES_ENV_POSTGRES_PASSWORD=postgres
POSTGRES_PORT_5432_TCP_ADDR=172.17.0.2
POSTGRES_PORT_5432_TCP_PORT=5432
POSTGRES_ENV_POSTGRES_USER=postgres
POSTGRES_PORT_5432_TCP_PROTO=tcp
POSTGRES_ENV_no_proxy=*.local, 169.254/16
POSTGRES_PORT=tcp://172.17.0.2:5432
POSTGRES_ENV_PG_SHA256=1645b3736901f6d854e695a937389e68ff2066ce0cde9d73919d6ab7c995b9c6
POSTGRES_ENV_PG_MAJOR=9.6
POSTGRES_NAME=/momento/postgres
POSTGRES_PORT_5432_TCP=tcp://172.17.0.2:5432
POSTGRES_ENV_POSTGRES_DB=thesis
POSTGRES_ENV_PGDATA=/var/lib/postgresql/data

---


INSPECT FROM OUTSIDE CONTAINER (better to login to container / see above)
docker inspect --format='{{json .Config}}' $INSTANCE_ID

ATTEMPTED THE DOCKER STACK WITH DOCKER-COMPOSE.YML
docker stack rm momentoapp 2>/dev/null
docker swarm leave --force 2>/dev/null
docker swarm init
docker stack deploy -c docker-compose.yml momentoapp
docker stack ls
docker stack ps momentoapp